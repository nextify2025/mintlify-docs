---
title: "行情数据"
description: "PTrade 行情数据获取 API"
---

**函数导航**

**基础信息**: [`get_trading_day`](#get_trading_day---获取交易日期) | [`get_all_trades_days`](#get_all_trades_days---获取全部交易日期) | [`get_trade_days`](#get_trade_days---获取指定范围交易日期) | [`get_trading_day_by_date`](#get_trading_day_by_date---按日期获取指定交易日)

**行情信息**: [`get_history`](#get_history---获取历史行情) | [`get_price`](#get_price---获取历史数据) | [`get_snapshot`](#get_snapshot---获取行情快照) | [`get_gear_price`](#get_gear_price---获取档位行情价格)

**证券信息**: [`get_stock_name`](#get_stock_name---获取证券名称) | [`get_stock_info`](#get_stock_info---获取证券基础信息) | [`get_index_stocks`](#get_index_stocks---获取指数成份股) | [`get_industry_stocks`](#get_industry_stocks---获取行业成份股) | [`get_Ashares`](#get_ashares---获取指定日期a股代码列表) | [`get_etf_list`](#get_etf_list---获取etf代码) | [`get_etf_info`](#get_etf_info---获取etf信息) | [`get_etf_stock_list`](#get_etf_stock_list---获取etf成分券列表) | [`get_cb_list`](#get_cb_list---获取可转债市场代码表) | [`get_cb_info`](#get_cb_info---获取可转债基础信息) | [`get_fundamentals`](#get_fundamentals---获取财务数据)

**其他信息**: [`get_position`](#get_position---获取单只标的持仓) | [`get_positions`](#get_positions---获取多只标的持仓) | [`get_all_positions`](#get_all_positions---获取全部持仓) | [`get_deliver`](#get_deliver---获取历史交割单) | [`get_fundjour`](#get_fundjour---获取历史资金流水)

---

## 获取基础信息

### get_trading_day - 获取交易日期

获取当前时间数天前或数天后的交易日期。

**使用场景**: 研究、回测、交易模块可用

```python
get_trading_day(day)
```

### 参数

| 参数 | 类型 | 默认值 | 说明 |
|-----|-----|------|------|
| day | int | 0 | 天数偏移量。正数为数天后，负数为数天前。0 表示当前交易日，非交易日返回上一交易日 |

### 返回

`datetime.date` 日期对象

### 示例

```python
def initialize(context):
    g.security = ['600670.SS', '000001.SZ']
    set_universe(g.security)

def handle_data(context, data):
    # 获取后一天的交易日期
    next_trading_date = get_trading_day(1)
    log.info(next_trading_date)
    # 获取前一天的交易日期
    previous_trading_date = get_trading_day(-1)
    log.info(previous_trading_date)
```

<Note>
- 回测中当前时间为策略调用接口的回测日日期 `context.blotter.current_dt`
- 研究/交易中当前时间为调用当天日期
- 不建议获取交易所还未公布的交易日期
</Note>

---

### get_all_trades_days - 获取全部交易日期

获取某个日期之前的所有交易日日期。

**使用场景**: 研究、回测、交易模块可用

```python
get_all_trades_days(date=None)
```

### 参数

| 参数 | 类型 | 默认值 | 说明 |
|-----|-----|------|------|
| date | str | None | 查询日期，如 '2016-02-13' 或 '20160213'。None 取当前日期 |

### 返回

包含所有交易日的 `numpy.ndarray`

### 示例

```python
def initialize(context):
    # 获取当前回测日期之前的所有交易日
    all_trades_days = get_all_trades_days()
    log.info(all_trades_days)
    all_trades_days_date = get_all_trades_days('20150312')
    log.info(all_trades_days_date)
```

<Note>
该接口返回的最早交易日日期为 2005-01-04。
</Note>

---

### get_trade_days - 获取指定范围交易日期

获取指定范围内的交易日期。

**使用场景**: 研究、回测、交易模块可用

```python
get_trade_days(start_date=None, end_date=None, count=None)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| start_date | str | 开始日期，与 count 二选一。最早不超过1990年 |
| end_date | str | 结束日期。超过今年则返回截止到今年的数据 |
| count | int | 数量，与 start_date 二选一。获取 end_date 往前的 count 个交易日 |

### 返回

包含指定范围交易日的 `numpy.ndarray`

### 示例

```python
def handle_data(context, data):
    # 获取指定范围内交易日
    trade_days = get_trade_days('2016-01-01', '2016-02-01')
    log.info(trade_days)
    # 获取回测日期往前10天的所有交易日
    trading_days = get_trade_days(count=10)
    log.info(trading_days)
```

---

### get_trading_day_by_date - 按日期获取指定交易日

根据输入日期获取指定的交易日。主要用于按固定自然日调仓的场景。

**使用场景**: 研究、回测、交易模块可用

```python
get_trading_day_by_date(query_date, day=0)
```

### 参数

| 参数 | 类型 | 默认值 | 说明 |
|-----|-----|------|------|
| query_date | str | - | 查询日期，如 "20230213"（必填） |
| day | int | 0 | 天数偏移量。正数为数天后，负数为数天前。0 表示当前交易日，非交易日返回下一交易日 |

### 返回

交易日日期 (str)

### 示例

```python
def handle_data(context, data):
    current_date = context.blotter.current_dt.strftime('%Y-%m-%d')
    trading_date = get_trading_day_by_date("20230501", 0)
    if trading_date == current_date:
        log.info("今日是5月1日之后首个交易日")
```

---

## 获取行情信息

### get_history - 获取历史行情

获取最近 N 条历史行情 K 线数据，支持多股票、多行情字段获取。

**使用场景**: 研究、回测、交易模块可用

```python
get_history(count, frequency='1d', field='close', security_list=None, fq=None, include=False, fill='nan', is_dict=False)
```

### 参数

| 参数 | 类型 | 默认值 | 说明 |
|-----|-----|------|------|
| count | int | - | K 线数量，必填 |
| frequency | str | '1d' | 周期：1m/5m/15m/30m/60m/120m/1d/1w/mo/1q/1y |
| field | str/list | 'close' | 字段：open/high/low/close/volume/money/price/is_open/preclose/high_limit/low_limit/unlimited |
| security_list | str/list | None | 股票代码。None 使用 set_universe 设置的股票池 |
| fq | str | None | 复权方式：None(不复权)/pre(前复权)/post(后复权)/dypre(动态前复权) |
| include | bool | False | 是否包含当前周期 |
| fill | str | 'nan' | 缺失数据填充：'pre'(用上一分钟数据)/'nan'(用NaN) |
| is_dict | bool | False | 是否返回 dict 格式（速度更快） |

### 返回

- **单只股票**: `pandas.DataFrame`，行索引为日期，列索引为字段
- **多只股票**: `pandas.DataFrame`，包含 code 列区分股票
- **is_dict=True**: `dict` 类型数据

### 示例

```python
def handle_data(context, data):
    # 获取过去5天收盘价
    df = get_history(5, '1d', 'close', '600570.SS')

    # 获取多只股票开盘价和收盘价
    df = get_history(2, '1d', ['open', 'close'], ['600570.SS', '600571.SS'])
    # 筛选单只股票数据
    df_570 = df.query('code in ["600570.SS"]')['open']

    # 获取周线数据
    his = get_history(5, '1w', 'close', '600570.SS')

    # 获取后复权收盘价
    his = get_history(5, '1d', 'close', '600570.SS', fq='post')
```

<Warning>
- 该接口只能获取 2005 年后的数据
- 针对停牌股票，时间轴为交易日日历，停牌时使用停牌前数据填充，成交量为 0
- 该接口与 `get_price` 不支持多线程同时调用
</Warning>

---

### get_price - 获取历史数据

获取指定日期前 N 条或指定时间段内的历史行情 K 线数据。

**使用场景**: 研究、回测、交易模块可用

```python
get_price(security, start_date=None, end_date=None, frequency='1d', fields=None, fq=None, count=None, is_dict=False)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| security | str/list | 股票代码或列表 |
| start_date | str | 开始时间，与 count 二选一。格式：YYYYmmdd/YYYY-mm-dd/YYYY-mm-dd HH:MM |
| end_date | str | 结束时间 |
| frequency | str | 周期：1m/5m/15m/30m/60m/120m/1d/1w/mo/1q/1y |
| fields | str/list | 字段：open/high/low/close/volume/money/price/is_open/preclose/high_limit/low_limit/unlimited |
| fq | str | 复权方式：None/pre/post/dypre |
| count | int | 获取 end_date 前 count 根数据，与 start_date 二选一 |
| is_dict | bool | 是否返回 dict 格式 |

### 示例

```python
def handle_data(context, data):
    # 按日期范围获取数据
    df = get_price('600570.SS',
                   start_date='20150101',
                   end_date='20150131',
                   frequency='1d')

    # 获取指定日期前N条数据
    df = get_price('600570.SS',
                   end_date='20150131',
                   frequency='1d',
                   count=10)

    # 获取分钟数据
    df = get_price('600570.SS',
                   end_date='2015-01-31 10:00',
                   frequency='1m',
                   count=10)
```

<Warning>
- start_date 与 count 必须且只能选择输入一个
- 数据返回内容不包括当天数据
- 周线/月线/季度/年线频率不支持 start_date/end_date 组合，只支持 end_date/count 组合
</Warning>

---

### get_snapshot - 获取行情快照

获取实时行情快照，仅交易模块可用。

```python
get_snapshot(security_list)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| security_list | str/list | 股票代码或列表 |

### 返回字段

| 字段 | 说明 |
|-----|------|
| last_px | 最新价 |
| open_px | 开盘价 |
| high_px | 最高价 |
| low_px | 最低价 |
| prev_close_px | 昨收价 |
| business_amount | 成交量 |
| business_balance | 成交额 |
| up_px | 涨停价 |
| down_px | 跌停价 |
| bid_grp | 买盘五档 |
| offer_grp | 卖盘五档 |

### 示例

```python
def handle_data(context, data):
    snapshot = get_snapshot('600570.SS')
    log.info(f"最新价: {snapshot['last_px']}")
    log.info(f"涨跌幅: {snapshot['px_change_rate']}%")
```

---

### get_gear_price - 获取档位行情价格

获取指定代码的买卖盘档位价格。

```python
get_gear_price(security, gear=1, direction='bid')
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| security | str | 股票代码 |
| gear | int | 档位，1-5 |
| direction | str | "bid"(买) 或 "offer"(卖) |

---

## 获取证券信息

### get_stock_name - 获取证券名称

```python
get_stock_name(security)
```

### get_stock_info - 获取证券基础信息

```python
get_stock_info(security)
```

返回包含以下字段的字典：

| 字段 | 说明 |
|-----|------|
| stock_code | 证券代码 |
| stock_name | 证券名称 |
| exchange_type | 交易所类型 |
| list_date | 上市日期 |

---

### get_index_stocks - 获取指数成份股

```python
get_index_stocks(index_code, date=None)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| index_code | str | 指数代码 |
| date | str | 日期，None 为当前日期 |

### 示例

```python
# 获取沪深300成份股
stocks = get_index_stocks('000300.SS')
```

---

### get_industry_stocks - 获取行业成份股

```python
get_industry_stocks(industry_code)
```

---

### get_Ashares - 获取指定日期A股代码列表

```python
get_Ashares(date=None)
```

---

### get_etf_list - 获取ETF代码

```python
get_etf_list()
```

---

### get_etf_info - 获取ETF信息

```python
get_etf_info(etf_code)
```

---

### get_etf_stock_list - 获取ETF成分券列表

```python
get_etf_stock_list(etf_code)
```

---

### get_cb_list - 获取可转债市场代码表

```python
get_cb_list()
```

---

### get_cb_info - 获取可转债基础信息

```python
get_cb_info(cb_code)
```

---

### get_fundamentals - 获取财务数据

获取财务三大报表数据、日频估值数据、各项财务能力指标数据。

**使用场景**: 研究、回测、交易模块可用

```python
get_fundamentals(security, table, fields=None, date=None, start_year=None, end_year=None, report_types=None, merge_type=None, is_dataframe=False)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| security | str/list | 股票代码或列表 |
| table | str | 财务数据表名（见下表） |
| fields | str/list | 输出字段 |
| date | str | 查询日期，与 start_year/end_year 二选一 |
| start_year | str | 查询开始年份，如 '2015' |
| end_year | str | 查询截止年份 |
| report_types | str | 财报类型：'1'一季报/'2'半年报/'3'三季报/'4'年报 |
| merge_type | int | 数据更新设置：None 首次发布数据，1 获取更新数据 |

### 可用表名

| 表名 | 说明 |
|-----|------|
| valuation | 估值数据 |
| balance_statement | 资产负债表 |
| income_statement | 利润表 |
| cashflow_statement | 现金流量表 |
| growth_ability | 成长能力指标 |
| profit_ability | 盈利能力指标 |
| eps | 每股指标 |
| operating_ability | 营运能力指标 |
| debt_paying_ability | 偿债能力指标 |

### 示例

```python
def handle_data(context, data):
    # 按日期查询模式
    get_fundamentals('600000.SS', 'balance_statement', 'total_assets', '20160628')

    # 按年份查询模式
    get_fundamentals('600000.SS', 'balance_statement', 'total_assets',
                     start_year='2013', end_year='2015', report_types='1')
```

<Warning>
growth_ability、profit_ability、eps、operating_ability、debt_paying_ability 五张表的数据非 PIT 类型数据，在财报期范围内按日期请求时，如某股票未发布该期财报，将无法获取到数据。
</Warning>

---

## 获取其他信息

### get_position - 获取单只标的持仓

```python
get_position(security)
```

返回 Position 对象。

### get_positions - 获取多只标的持仓

```python
get_positions(security_list)
```

### get_all_positions - 获取全部持仓

```python
get_all_positions()
```

返回 dict，key 为股票代码，value 为 Position 对象。

---

### get_deliver - 获取历史交割单

```python
get_deliver(start_date, end_date)
```

### get_fundjour - 获取历史资金流水

```python
get_fundjour(start_date, end_date)
```
