---
title: "融资融券"
description: "PTrade 融资融券交易 API"
---

**函数导航**

**交易函数**: [`margin_trade`](#margin_trade---担保品买卖) | [`margincash_open`](#margincash_open---融资买入) | [`margincash_close`](#margincash_close---卖券还款) | [`margincash_direct_refund`](#margincash_direct_refund---直接还款) | [`marginsec_open`](#marginsec_open---融券卖出) | [`marginsec_close`](#marginsec_close---买券还券) | [`marginsec_direct_refund`](#marginsec_direct_refund---直接还券)

**查询函数**: [`get_margincash_stocks`](#get_margincash_stocks---获取融资标的列表) | [`get_marginsec_stocks`](#get_marginsec_stocks---获取融券标的列表) | [`get_margin_contract`](#get_margin_contract---合约查询) | [`get_margin_contractreal`](#get_margin_contractreal---实时合约查询) | [`get_margin_asset`](#get_margin_asset---信用资产查询) | [`get_assure_security_list`](#get_assure_security_list---担保券查询) | [`get_margincash_open_amount`](#get_margincash_open_amount---融资标的最大可买数量) | [`get_margincash_close_amount`](#get_margincash_close_amount---卖券还款最大可卖数量) | [`get_marginsec_open_amount`](#get_marginsec_open_amount---融券标的最大可卖数量) | [`get_marginsec_close_amount`](#get_marginsec_close_amount---买券还券最大可买数量) | [`get_margin_entrans_amount`](#get_margin_entrans_amount---现券还券数量查询) | [`get_enslo_security_info`](#get_enslo_security_info---融券信息查询) | [`get_crdt_fund`](#get_crdt_fund---可融资金信息查询)

---

## 融资融券交易类函数

### margin_trade - 担保品买卖

使用担保品账户进行股票买卖。

```python
margin_trade(security, amount, limit_price=None)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| security | str | 股票代码 |
| amount | int | 委托数量，正数买入，负数卖出 |
| limit_price | float | 限价 |

---

### margincash_open - 融资买入

融资买入股票。

```python
margincash_open(security, amount, limit_price=None)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| security | str | 股票代码 |
| amount | int | 买入数量 |
| limit_price | float | 限价 |

---

### margincash_close - 卖券还款

卖出股票偿还融资负债。

```python
margincash_close(security, amount, limit_price=None)
```

---

### margincash_direct_refund - 直接还款

使用现金直接偿还融资负债。

```python
margincash_direct_refund(amount)
```

### 参数

| 参数 | 类型 | 说明 |
|-----|-----|------|
| amount | float | 还款金额 |

---

### marginsec_open - 融券卖出

融券卖出股票。

```python
marginsec_open(security, amount, limit_price=None)
```

---

### marginsec_close - 买券还券

买入股票偿还融券负债。

```python
marginsec_close(security, amount, limit_price=None)
```

---

### marginsec_direct_refund - 直接还券

使用持有的股票直接偿还融券负债。

```python
marginsec_direct_refund(security, amount)
```

---

## 融资融券查询类函数

### get_margincash_stocks - 获取融资标的列表

```python
get_margincash_stocks()
```

**返回**: list，可融资标的代码列表

---

### get_marginsec_stocks - 获取融券标的列表

```python
get_marginsec_stocks()
```

**返回**: list，可融券标的代码列表

---

### get_margin_contract - 合约查询

查询融资融券合约信息。

```python
get_margin_contract(security=None)
```

---

### get_margin_contractreal - 实时合约查询

```python
get_margin_contractreal(security=None)
```

---

### get_margin_asset - 信用资产查询

查询信用账户资产信息。

```python
get_margin_asset()
```

### 返回字段

| 字段 | 说明 |
|-----|------|
| total_asset | 总资产 |
| net_asset | 净资产 |
| margin_amount | 保证金 |
| fin_debit | 融资负债 |
| slo_debit | 融券负债 |
| maintain_rate | 维持担保比例 |

---

### get_assure_security_list - 担保券查询

```python
get_assure_security_list()
```

---

### get_margincash_open_amount - 融资标的最大可买数量

```python
get_margincash_open_amount(security)
```

---

### get_margincash_close_amount - 卖券还款最大可卖数量

```python
get_margincash_close_amount(security)
```

---

### get_marginsec_open_amount - 融券标的最大可卖数量

```python
get_marginsec_open_amount(security)
```

---

### get_marginsec_close_amount - 买券还券最大可买数量

```python
get_marginsec_close_amount(security)
```

---

### get_margin_entrans_amount - 现券还券数量查询

```python
get_margin_entrans_amount(security)
```

---

### get_enslo_security_info - 融券信息查询

```python
get_enslo_security_info(security)
```

---

### get_crdt_fund - 可融资金信息查询

```python
get_crdt_fund()
```

---

## 示例：融资买入策略

```python
def initialize(context):
    g.security = '600570.SS'
    set_universe(g.security)

def handle_data(context, data):
    # 检查是否为融资标的
    margin_stocks = get_margincash_stocks()
    if g.security not in margin_stocks:
        log.info("非融资标的")
        return

    # 查询最大可融资买入数量
    max_amount = get_margincash_open_amount(g.security)
    log.info(f"最大可融资买入: {max_amount}股")

    # 融资买入
    if max_amount > 0:
        margincash_open(g.security, min(1000, max_amount))
```
